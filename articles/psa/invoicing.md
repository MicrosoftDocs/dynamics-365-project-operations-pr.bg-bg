---
title: Фактуриране в Project Service Automation
description: Тази тема предоставя информация за фактурирането.
author: rumant
manager: kfend
ms.custom:
- dyn365-projectservice
ms.date: 08/03/2020
ms.topic: article
ms.service: business-applications
ms.author: rumant
audience: Admin
search.audienceType:
- admin
- customizer
- enduser
search.app:
- D365PS
- ProjectOperations
ms.openlocfilehash: f8107a660f9993c7b6a32d69047a81fb7e0abef8
ms.sourcegitcommit: 5c4c9bf3ba018562d6cb3443c01d550489c415fa
ms.translationtype: HT
ms.contentlocale: bg-BG
ms.lasthandoff: 10/16/2020
ms.locfileid: "4071884"
---
# <a name="invoicing-in-project-service-automation"></a>Фактуриране в Project Service Automation

[!INCLUDE[cc-applies-to-psa-app-3.x](../includes/cc-applies-to-psa-app-3x.md)]

Фактурирането в Dynamics 365 Project Service Automation е полезно, защото дава на мениджърите на проекти второ ниво на одобрение, преди да създадат фактури за клиенти. Първото ниво на одобрение се попълва, когато се одобрят записите за часа и разходите, които членовете на екипа по проекта подават.

PSA не е проектирано да генерира фактури за клиенти по следните причини:

- Не съдържа данъчна информация.
- Не може да конвертира други валути във валутата за фактуриране, като използва правилно конфигурирани обменни курсове.
- Не може да форматира правилно фактури, така че да могат да бъдат отпечатани.

Вместо това можете да използвате финансова или счетоводна система за създаване на фактури за клиенти, които използват информацията от предложенията за фактури, генерирани в PSA.

## <a name="creating-project-invoices-in-psa"></a>Създаване на фактури за проект в PSA

Фактурите по проект могат да бъдат създавани индивидуално или групово. Можете да ги създавате ръчно или да ги конфигурирате да се генерират в автоматизирани цикли.

### <a name="manually-create-project-invoices-in-psa"></a>Ръчно създаване на фактури по проект в PSA

От страницата със списъка **Договори по проекти** можете да създавате фактури по проекти поотделно за всеки договор по проект или групово за няколко договора по проекти.

Изпълнете тази стъпка, за да създадете фактура за конкретен договор по проект.

- На страницата със списъка **Договори по проект** отворете договор по проект и след това изберете **Създаване на фактура**.

    ![Създаване на фактури по проект за конкретен договор по проект](media/CreateProjectInvoicesOneByOne.png)

    Генерира се фактура за всички транзакции за избрания договор по проект, които имат състояние **Готово за фактуриране**. Тези транзакции включват време, разходи, контролни точки и редове на договор, базирани на продукти.

Изпълнете следните стъпки, за да създадете групово фактури.

1. На страницата със списъка **Договори по проекти** изберете един или повече договори по проекти, за които трябва да създадете фактура, след което изберете **Създаване на фактури за проект**.

    ![Групово създаване на фактури за проект](media/CreateProjectInvoicesBulk.png)

    Предупредително съобщение ви информира, че може да има закъснение, преди да бъдат създадени фактурите. Процесът също е показан.

2. Изберете **ОК** , за да затворите прозореца на съобщението.

    Генерира се фактура за всички транзакции в ред на договор, които имат състояние **Готово за фактуриране**. Тези транзакции включват време, разходи, контролни точки и редове на договор, базирани на продукти.

3. За да прегледате генерираните фактури, отидете на **Продажби** \> **Фактуриране** \> **Фактури**. Ще видите една фактура за всеки договор по проект.

### <a name="set-up-automated-creation-of-project-invoices-in-psa"></a>Настройване на автоматизирано създаване на фактури за проект в PSA

Изпълнете следните стъпки, за да конфигурирате автоматичен цикъл на фактуриране в PSA.

1. Отидете на **Project Service** \> **Настройки** \> **Пакетни задания**.
2. Създайте пакетно задание и го наименувайте **Създаване на фактури в PSA**. Името на пакетното задание трябва да включва термина „създаване на фактури“.
3. В полето **Тип задание** изберете **Няма**. По подразбиране опциите **Честота дневно** и **Е активно** са зададени на **Да**.
4. Изберете **Стартиране на работен поток**. В диалоговия прозорец **Търсене на запис** ще видите три работни процеса:

    - ProcessRunCaller
    - ProcessRunner
    - UpdateRoleUtilization

5. Изберете **ProcessRunCaller** и след това **Добавяне**.
6. В следващия диалогов прозорец изберете **OK**. Работен поток **Заспиване** е последван от работен поток **Обработване**.

    Можете също да изберете **ProcessRunner** в стъпка 5. След това, когато изберете **OK** , работният поток **Обработка** е последван от работен поток **Заспиване**.

Работните потоци **ProcessRunCaller** и **ProcessRunner** създават фактури. **ProcessRunCaller** извиква **ProcessRunner**. **ProcessRunner** е работният поток, който всъщност създава фактурите. Той преминава през всички редове на договора, за които трябва да бъдат създадени фактури, и създава фактури за тези редове. За да определи редовете на договора, за които трябва да бъдат създадени фактури, заданието търси в датите на изпълнение на фактурите за редовете на договора. Ако редове на договор, които принадлежат към един договор, имат една и съща дата на изпълнение на фактура, транзакциите се комбинират в една фактура, която има два реда. Ако няма транзакции, за които да бъдат създадени фактури, заданието пропуска създаването на фактури.

След като **ProcessRunner** завърши изпълнението на цикъла, той извиква **ProcessRunCaller** , дава крайния час, и се затваря. **ProcessRunCaller** след това стартира таймер, който работи в продължение на 24 часа от посочения краен час. В края на таймера **ProcessRunCaller** се затваря.

Заданието за пакетно обработване за създаване на фактури е повтарящо се задание. Ако това пакетно обработване се изпълнява много пъти, се създават няколко екземпляра на заданието и причиняват грешки. Затова трябва да стартирате пакетното обработване само един път и трябва да го рестартирате само ако спре да работи.

> [!NOTE]
> Груповото фактуриране в Project Service Automation работи само за аспекти на договор по проект, които са конфигурирани от графици за фактуриране. Аспекти на договор с метод на фактуриране по фиксирана цена трябва да имат конфигурирани контролни точки. Аспекти на договор по проект с метод на фактуриране по време и материали ще се нуждаят от зададен график за фактуриране, базиран на дата. Информация за настройката на честотите на фактуриране в контекста на проект, който се основава на ред на оферта, е предоставена в темата [Оферти и редове на оферти](basic-quote-lines.md#invoice-schedule). Същото се отнася и за аспекти на договор, базирани на проект.      
 
### <a name="edit-a-draft-psa-invoice"></a>Редактиране на чернова на фактура в PSA

Когато създавате чернова на фактура по проект, всички нефактурирани продажбени транзакции, които са създадени, когато са одобрени записите за време и разходи, се изтеглят във фактурата. Можете да направите следните корекции, докато фактурата все още е в етап на чернова:

- Изтриване или редактиране на подробностите за ред на фактурата.
- Редактиране и коригиране на количеството и типа фактуриране.
- Директно добавяне на време, разходи и такси като транзакции във фактурата. Можете да използвате тази функция, ако редът от фактурата се съпоставя към ред на договор, който позволява тези класове транзакции.

Изберете **Потвърждаване** , за да потвърдите фактура. Действието за потвърждаване е еднопосочно. Когато изберете **Потвърждаване** , системата прави фактурата само за четене и създава фактурирани действителни продажби от всяка подробност за ред на фактурата за всеки ред на фактурата. Ако подробностите за реда на фактурата се позовават на нефактурирана действителна продажба, системата също така сторнира нефактурираната действителна продажба. (Всички подробности за ред на фактура, създадени от запис за време или разходи, ще се позовават на нефактурирана действителна продажба.) Интеграционни системи за счетоводство могат да използват това сторниране, за да сторнират незавършено производство (НП) за счетоводни цели.

### <a name="correct-a-confirmed-psa-invoice"></a>Коригиране на потвърдена фактура в PSA

Потвърдени фактури в PSA могат да бъдат редактирани (коригирани). Когато коригирате потвърдена фактура, се създава нова чернова на коригираща фактура. Тъй като се предполага, че искате да сторнирате всички транзакции и количества от първоначалната фактура, тази коригираща фактура включва всички транзакции от оригиналната фактура и всички количества в нея са 0 (нула).

Ако транзакциите не изискват корекция, можете да ги премахнете от черновата на коригираща фактура. Ако искате да сторнирате или да върнете само частично количество, можете да редактирате полето **Количество** в подробностите за реда. Ако отворите подробностите за реда на фактурата, можете да видите количеството в първоначалната фактура. След това можете да редактирате количеството в текущата фактура, така че да е по-малко или повече от количеството в първоначалната фактура.

Когато потвърдите коригираща фактура, първоначално фактурираните действителни продажби се сторнират и се създават нови фактурирани действителни продажби. Ако количеството е било намалено, разликата ще доведе до създаването също и на нова нефактурирана действителна продажба. Например, ако първоначалните фактурирани продажби са били за осем часа, а подробностите на реда на коригиращата фактура имат намалено количество от шест часа, PSA сторнира реда на първоначално фактурираната продажба и създава две нови действителни данни:

- фактурирана действителна продажба за шест часа.
- нефактурирана действителна продажба за оставащите два часа. Тази транзакция може или да бъде фактурирана по-късно, или отбелязана като неплатима, в зависимост от договорките с клиента.
