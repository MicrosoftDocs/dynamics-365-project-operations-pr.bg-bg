---
title: Използване на API за график на проект с Power Automate
description: Тази статия предоставя примерен поток, който използва програмните интерфейси (API) на графика на проекта.
author: ruhercul
ms.date: 01/26/2022
ms.topic: article
ms.reviewer: johnmichalak
ms.author: ruhercul
ms.openlocfilehash: afec082c680596e8dcb8ec0b350b4bb7853c49ff
ms.sourcegitcommit: 7ed8e77a92917f2d242988ca02bd7de9571cce5e
ms.translationtype: MT
ms.contentlocale: bg-BG
ms.lasthandoff: 09/02/2022
ms.locfileid: "9404450"
---
# <a name="use-project-schedule-apis-with-power-automate"></a>Използване на API за график на проект с Power Automate

_**Отнася се за:** Project Operations за сценарии, базирани на ресурси / без складови наличности, внедряване на Lite - сделка с проформа фактуриране_

Тази статия описва примерен поток, който показва как да създадете пълен план на проект с помощта на Microsoft Power Automate, как да създадете набор от операции и как да актуализирате обект. Примерът демонстрира как да създадете проект, член на екипа на проекта, набори от операции, задачи на проекта и присвояване на ресурси. Тази статия също така обяснява как да актуализирате обект и да изпълните набор от операции.

Следва пълен списък на стъпките, които са документирани в примерния поток в тази статия:

1. [Създаване на активатор на PowerApps](#1)
2. [Създаване на проект](#2)
3. [Инициализирайте променлива за члена на екипа](#3)
4. [Създаване на общ член на екипа](#4)
5. [Създаване на набор от опции](#5)
6. [Създаване на контейнер за проект](#6)
7. [Инициализирайте променлива за състоянието на връзка](#7)
8. [Инициализирайте променлива за броя задачи](#8)
9. [Инициализирайте променлива за ИД на задачата по проекта](#9)
10. [Да се изпълнява, докато](#10)
11. [Задаване на задача по проект](#11)
12. [Създаване на задача по проект](#12)
13. [Създаване на присвоявания на ресурс](#13)
14. [Намаляване на променлива](#14)
15. [Преименуване на задача на проекта](#15)
16. [Изпълнение на набор от опции](#16)

## <a name="assumptions"></a>Предположения

Тази статия предполага, че имате основни познания за платформата Dataverse, облачни потоци и интерфейс за програмиране на приложения за график на проекта (API). За повече информация вижте секцията [Предпочитания](#references) по-късно в тази статия.

## <a name="create-a-flow"></a>Създай поток

### <a name="select-an-environment"></a>Изберете среда

Не можете да създавате поток на Power Automate в средата си.

1. Отидете на <https://flow.microsoft.com> и използвайте идентификационните си данни за администратор, за да влезете.
2. В горния десен ъгъл изберете **Среди**.
3. В списъка изберете средата, в която е инсталиран Dynamics 365 Project Operations.

### <a name="create-a-solution"></a>Създаване на решение

Следвайте тези стъпки, за да създадете [поток, ориентиран към решенията](/power-automate/overview-solution-flows). Като създадете поток, съобразен с решението, можете по-лесно да експортирате потока, за да го използвате по-късно.

1. В прозореца за навигация изберете **Решения**.
2. На страницата **Решения** изберете **Ново решение**.
3. В диалоговия прозорец **Ново решение**, задайте задължителните полета и изберете **Създаване**.

## <a name="step-1-create-a-powerapps-trigger"></a><a id="1"></a>Стъпка 1: Създаване на активатор на PowerApps

1. На страницата **Решения** изберете решението, което сте създали, и след това изберете **Създаване**.
2. В левия прозорец изберете **Потоци за облак** \> **Автоматизация** \> **Поток за облак** \> **Моментален**.
3. В полето **Име на потока** въведете **График на демонстрационен поток на API**.
4. В списъка **Изберете как да задействате този поток** изберете **Power Apps**. Когато създавате активатор на Power Apps логиката зависи от вас като автор. В тази статия оставете входните параметри празни за целите на тестването.
5. Изберете **Създаване**.

## <a name="step-2-create-a-project"></a><a id="2"></a>Стъпка 2: Създаване на проект

Изпълнете следните стъпки, за да създадете примерен проект.

1. В потока който сте създали, изберете **Нова стъпка**.

    ![Добавяне на нова стъпка.](media/newstep.png)

2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **извършва необвързано действие**. След това в раздела **Действия** изберете операцията в списъка с резултати.

    ![Избор на операция.](media/chooseactiontab.png)

3. В новата стъпка изберете многоточието (**...**), след което изберете **Преименуване**.

![Преименуване на стъпка.](media/renamestep.png)

4. Преименувайте стъпката на **Създаване на проект**.
5. В полето **Име на действие** изберете **msdyn\_CreateProjectV1**.
6. Под полето **msdyn\_subject** изберете **Добавяне на динамично съдържание**.
7. В раздела **Израз** в полето за функция въведете **Име на проекта - utcNow()**.
8. Изберете **OK**.

## <a name="step-3-initialize-a-variable-for-the-team-member"></a><a id="3"></a>Стъпка 3: Инициализирайте променлива за члена на екипа

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **инициализиране на променлива**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. В новата стъпка изберете многоточието (**...**), след което изберете **Преименуване**.
4. Преименувайте стъпката **Член на екипа за стартиране**.
5. В полето **Име** въведете **TeamMemberAction**.
6. В полето **Тип** изберете **Низ**.
7. В полето **Стойност** въведете **msdyn\_CreateTeamMemberV1**.

## <a name="step-4-create-a-generic-team-member"></a><a id="4"></a>Стъпка 4: Създайте общ член на екипа

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **извършва необвързано действие**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. В новата стъпка изберете многоточието (**...**), след което изберете **Преименуване**.
4. Преименувайте стъпката **Създаване на член на екипа**.
5. За полето **Име на действие** изберете **TeamMemberAction** в диалогов прозорец **Динамично съдържание**.
6. В полето **Параметри на действие** въведете следната информация за параметъра.

    ```
    {
        "TeamMember": {
            "@@odata.type": "Microsoft.Dynamics.CRM.msdyn_projectteam",
            "msdyn_projectteamid": "@{guid()}",
            "msdyn_project@odata.bind": "/msdyn_projects(@{outputs('Create_Project')?['body/ProjectId']})",
            "msdyn_name": "ScheduleAPIDemoTM1"
        }
    } 
    ```

    Ето обяснение на параметрите:

    - **\@\@odata.type** – Името на обекта. Например въведете **"Microsoft.Dynamics.CRM.msdyn\_projectteam"**.
    - **msdyn\_projectteamid** – Първичният ключ на ИД на екипа на проекта. Стойността е израз на глобален еднозначен идентификатор (GUID).   Идентификаторът се генерира от раздела за изрази.

    - **msdyn\_project\@odata.bind** – Идентификаторът на проекта, на който принадлежи. Стойността ще бъде динамично съдържание, което идва от отговора на стъпката „Създаване на проект“. Уверете се, че сте въвели пълния път и добавете динамично съдържание между скобите. Кавичките са задължителни. Например въведете **"/msdyn\_projects(ADD DYNAMIC CONTENT)"**.
    - **msdyn\_name** – Името на члена на екипа. Например, въведете **"ScheduleAPIDemoTM1"**.

## <a name="step-5-create-an-operation-set"></a><a id="5"></a>Стъпка 5: Създаване на набор от опции

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **извършва необвързано действие**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. В новата стъпка изберете многоточието (**...**), след което изберете **Преименуване**.
4. Преименувайте стъпката **Създаване на набор от операции**.
5. В полето **Име на действие** изберете персонализирано действие на Dataverse **msdyn\_CreateOperationSetV1**.
6. В полето **Описание** въведете **ScheduleAPIDemoOperationSet**.
7. В полето **Проект** въведете **/msdyn\_projects(**.
8. В диалоговия прозорец **Динамично съдържание** изберете **msdyn\_CreateProjectV1Response ProjectId**.
9. В полето **Проект** въведете **)**.

## <a name="step-6-create-a-project-bucket"></a><a id="6"></a>Стъпка 6: Създаване на контейнер на проект

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **добавяне на нов ред**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. В новата стъпка изберете многоточието (**...**), след което изберете **Преименуване**.
4. Преименувайте стъпката на **Създаване на контейнер**.
5. В полето **Име на таблица** изберете **Контейнери на проект**.
6. В полето **Име** въведете **ScheduleAPIDemoBucket1**.
7. За полето **Проект** изберете **msdyn\_CreateProjectV1Response ProjectId** в диалоговия прозорец **Динамично съдържание**.

## <a name="step-7-initialize-a-variable-for-the-link-status"></a><a id="7"></a>Стъпка 7: Инициализирайте променлива за състоянието на връзка

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **инициализиране на променлива**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. В новата стъпка изберете многоточието (**...**), след което изберете **Преименуване**.
4. Преименувайте стъпката **Първоначално състояние на връзката**.
5. В полето **Име** въведете **linkstatus**.
6. В полето **Тип** изберете **Цяло число**.
7. В полето **Стойност** въведете **192350000**.

## <a name="step-8-initialize-a-variable-for-the-number-of-tasks"></a><a id="8"></a>Стъпка 8: Инициализирайте променлива за броя задачи

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **инициализиране на променлива**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. В новата стъпка изберете многоточието (**...**), след което изберете **Преименуване**.
4. Преименувайте стъпката **Първоначален Брой задачи**.
5. В полето **Име** въведете **брой задачи**.
6. В полето **Тип** изберете **Цяло число**.
7. В полето **Стойност** въведете **5**.

## <a name="step-9-initialize-a-variable-for-the-project-task-id"></a><a id="9"></a>Стъпка 9: Инициализирайте променлива за ИД на задачата по проекта

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **инициализиране на променлива**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. В новата стъпка изберете многоточието (**...**), след което изберете **Преименуване**.
4. Преименувайте стъпката **Първоначален ProjectTaskID**.
5. В полето **Име** въведете **брой задачи**.
6. В полето **Тип** изберете **Низ**.
7. За полето **Стойност** въведете **guid()** в конструктора на изрази.

## <a name="step-10-do-until"></a><a id="10"></a>Стъпка 10: Да се изпълнява, докато

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **да се изпълнява, докато**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. Задайте първата стойност в условния оператор на променливата **брой задачи** от диалогов прозорец **Динамично съдържание**.
4. Задайте условието на **по-малко или равно на**.
5. Задайте втората стойност в условния израз на **0**.

## <a name="step-11-set-a-project-task"></a><a id="11"></a>Стъпка 11: Задаване на задача по проект

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **задаване на променлива**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. В новата стъпка изберете многоточието (**...**), след което изберете **Преименуване**.
4. Преименувайте стъпката **Задаване на задача по проект**.
5. В полето **Име** изберете **msdyn\_projecttaskid**.
6. За полето **Стойност** въведете **guid()** в конструктора на изрази.

## <a name="step-12-create-a-project-task"></a><a id="12"></a>Стъпка 12: Създаване на задача по проект

Следвайте тези стъпки, за да създадете проектна задача, която има уникален идентификатор, който принадлежи на текущия проект и групата на проекта, която сте създали.

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **извършва необвързано действие**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. В стъпката изберете многоточието (**...**), след което изберете **Преименуване**.
4. Преименувайте стъпката на **Създаване на задача по проект**.
5. В полето **Име на действие** изберете **msdyn\_PssCreateV1**.
6. В полето **Обект** въведете информация за следния параметър.

    ```
    {
        "@@odata.type": "Microsoft.Dynamics.CRM.msdyn_projecttask",
        "msdyn_projecttaskid": "@{variables('msdyn_projecttaskid')}",
        "msdyn_project@odata.bind": "/msdyn_projects(@{outputs('Create_Project')?['body/ProjectId']})",
        "msdyn_subject": "ScheduleAPIDemoTask1",
        "msdyn_projectbucket@odata.bind": "/msdyn_projectbuckets(@{outputs('Create_Project_Buckets')?['body/msdyn_projectbucketid']})",
        "msdyn_start": "@{addDays(utcNow(), 1)}",
        "msdyn_scheduledstart": "@{utcNow()}",
        "msdyn_scheduledend": "@{addDays(utcNow(), 5)}",
        "msdyn_LinkStatus": "192350000"
    }
    ```

    Ето обяснение на параметрите:

    - **\@\@odata.type** – Името на обекта. Например въведете **"Microsoft.Dynamics.CRM.msdyn\_projecttask"**.
    - **msdyn\_projecttaskid** – Еднозначният ИД на задачата. Стойността трябва да бъде зададена на динамична променлива от **msdyn\_projecttaskid**.
    - **msdyn\_project\@odata.bind** – Идентификаторът на проекта, на който принадлежи. Стойността ще бъде динамично съдържание, което идва от отговора на стъпката „Създаване на проект“. Уверете се, че сте въвели пълния път и добавете динамично съдържание между скобите. Кавичките са задължителни. Например въведете **"/msdyn\_projects(ADD DYNAMIC CONTENT)"**.
    - **msdyn\_subject** – Произволно име на задача.
    - **msdyn\_projectbucket\@odata.bind** – Контейнерът на проекта, който съдържа задачите. Стойността ще бъде динамично съдържание, което идва от отговора на стъпката „Създаване на контейнер“. Уверете се, че сте въвели пълния път и добавете динамично съдържание между скобите. Кавичките са задължителни. Например въведете **"/msdyn\_projectbuckets(ADD DYNAMIC CONTENT)"**.
    - **msdyn\_start** – Динамично съдържание за началната дата. Например утрешният ден ще бъде представен като **"addDays(utcNow(), 1)"**.
    - **msdyn\_scheduledstart** – Планираната начална дата. Например утрешният ден ще бъде представен като **"addDays(utcNow(), 1)"**.
    - **msdyn\_scheduleend** – Планираната крайна дата. Изберете дата в бъдещето. Например, посочете **"addDays(utcNow(), 5)"**.
    - **msdyn\_LinkStatus** – Състоянието на връзката. Например, въведете **"192350000"**.

7. За полето **OperationSetId** изберете **msdyn\_CreateOperationSetV1Response** в диалоговия прозорец **Динамично съдържание**.

## <a name="step-13-create-a-resource-assignment"></a><a id="13"></a>Стъпка 13: Създаване на присвояване на ресурс

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **извършва необвързано действие**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. В стъпката изберете многоточието (**...**), след което изберете **Преименуване**.
4. Преименувайте стъпката на **Създаване на присвояване**.
5. В полето **Име на действие** изберете **msdyn\_PssCreateV1**.
6. В полето **Обект** въведете информация за следния параметър.

    ```
    {
        "@@odata.type": "Microsoft.Dynamics.CRM.msdyn_resourceassignment",
        "msdyn_resourceassignmentid": "@{guid()}",
        "msdyn_name": "ScheduleAPIDemoAssign1",
        "msdyn_taskid@odata.bind": "/msdyn_projecttasks(@{variables('msdyn_projecttaskid')})",
        "msdyn_projectteamid@odata.bind": "/msdyn_projectteams(@{outputs('Create_Team_Member')?['body/TeamMemberId']})",
        "msdyn_projectid@odata.bind": "/msdyn_projects(@{outputs('Create_Project')?['body/ProjectId']})"
    }
    ```

7. За полето **OperationSetId** изберете **msdyn\_CreateOperationSetV1Response** в диалоговия прозорец **Динамично съдържание**.

## <a name="step-14-decrement-a-variable"></a><a id="14"></a>Стъпка 14: Намаляване на променлива

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **намаляване на променлива**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. В полето **Име** изберете **брой задачи**.
4. В полето **Стойност** въведете **1**.

## <a name="step-15-rename-a-project-task"></a><a id="15"></a>Стъпка 15: Преименуване на задача по проект

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **извършва необвързано действие**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. В стъпката изберете многоточието (**...**), след което изберете **Преименуване**.
4. Преименувайте стъпката на **Преименуване на задача по проект**.
5. В полето **Име на действие** изберете **msdyn\_PssUpdateV1**.
6. В полето **Обект** въведете информация за следния параметър.

    ```
    {
        "@@odata.type": "Microsoft.Dynamics.CRM.msdyn_projecttask",
        "msdyn_projecttaskid": "@{variables('msdyn_projecttaskid')}",
        "msdyn_subject": "ScheduleDemoTask1-UpdatedName"
    }
    ```

7. За полето **OperationSetId** изберете **msdyn\_CreateOperationSetV1Response** в диалоговия прозорец **Динамично съдържание**.

## <a name="step-16-run-an-operation-set"></a><a id="16"></a>Стъпка 16: Изпълнение на набор от опции

1. В потока изберете **Нова стъпка**.
2. В диалоговия прозорец **Изберете операция** в полето за търсене въведете **извършва необвързано действие**. След това в раздела **Действия** изберете операцията в списъка с резултати.
3. В стъпката изберете многоточието (**...**), след което изберете **Преименуване**.
4. Преименувайте стъпката **Изпълнение на набор от операции**.
5. В полето **Име на действие** изберете **msdyn\_ExecuteOperationSetV1**.
6. За полето **OperationSetId** изберете **msdyn\_CreateOperationSetV1Response OperationSetId** в диалоговия прозорец **Динамично съдържание**.

## <a name="references"></a>Препратки

- [Общ преглед на начина на интегриране на потоци с Dataverse – Power Automate](/power-automate/dataverse/overview?WT.mc_id=email)
- [Използвайте API за график на проекти, за да извършвате операции с обекти за планиране](schedule-api-preview.md)
- [Преглед на потоците за облак – Power Automate](/power-automate/overview-cloud?WT.mc_id=email)
- [Преглед на потоците, ориентирани към решението – Power Automate](/power-automate/overview-solution-flows?WT.mc_id=email)
