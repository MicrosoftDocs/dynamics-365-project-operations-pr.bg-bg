---
title: Фактуриране в Project Service Automation
description: Тази тема предоставя информация за фактурирането.
author: rumant
manager: kfend
ms.service: business-applications
ms.custom:
- dyn365-projectservice
ms.date: 03/11/2019
ms.topic: article
ms.prod: ''
ms.technology: Microsoft Dynamics 365  Project Service Automation 2.x and 3.x
audience: Admin
search.audienceType:
- admin
- customizer
- enduser
search.app:
- D365PS
ms.openlocfilehash: 8d95f17aba0a4cab65a6f020aade5e19568de3be
ms.sourcegitcommit: 8c786230ef2a497280885b827162561776e2eb00
ms.translationtype: HT
ms.contentlocale: bg-BG
ms.lasthandoff: 03/24/2020
ms.locfileid: "3749209"
---
# <a name="invoicing-in-project-service-automation"></a><span data-ttu-id="fb339-103">Фактуриране в Project Service Automation</span><span class="sxs-lookup"><span data-stu-id="fb339-103">Invoicing in Project Service Automation</span></span>

[!INCLUDE[cc-applies-to-psa-app-3.x](../includes/cc-applies-to-psa-app-3x.md)]

<span data-ttu-id="fb339-104">Фактурирането в Dynamics 365 Project Service Automation е полезно, защото дава на мениджърите на проекти второ ниво на одобрение, преди да създадат фактури за клиенти.</span><span class="sxs-lookup"><span data-stu-id="fb339-104">Invoicing in Dynamics 365 Project Service Automation is useful because it gives project managers a second level of approval before they create invoices for customers.</span></span> <span data-ttu-id="fb339-105">Първото ниво на одобрение се попълва, когато се одобрят записите за часа и разходите, които членовете на екипа по проекта подават.</span><span class="sxs-lookup"><span data-stu-id="fb339-105">The first level of approval is completed when the time and expense entries that project team members submit are approved.</span></span>

<span data-ttu-id="fb339-106">PSA не е проектирано да генерира фактури за клиенти по следните причини:</span><span class="sxs-lookup"><span data-stu-id="fb339-106">PSA isn't designed to generate customer-facing invoices, for the following reasons:</span></span>

- <span data-ttu-id="fb339-107">Не съдържа данъчна информация.</span><span class="sxs-lookup"><span data-stu-id="fb339-107">It doesn't contain tax information.</span></span>
- <span data-ttu-id="fb339-108">Не може да конвертира други валути във валутата за фактуриране, като използва правилно конфигурирани обменни курсове.</span><span class="sxs-lookup"><span data-stu-id="fb339-108">It can't convert other currencies to the invoicing currency by using correctly configured exchange rates.</span></span>
- <span data-ttu-id="fb339-109">Не може да форматира правилно фактури, така че да могат да бъдат отпечатани.</span><span class="sxs-lookup"><span data-stu-id="fb339-109">It can't correctly format invoices so that they can be printed.</span></span>

<span data-ttu-id="fb339-110">Вместо това можете да използвате финансова или счетоводна система за създаване на фактури за клиенти, които използват информацията от предложенията за фактури, генерирани в PSA.</span><span class="sxs-lookup"><span data-stu-id="fb339-110">Instead, you can use a financial or accounting system to create customer-facing invoices that use the information from invoice proposals that are generated in PSA.</span></span>

## <a name="creating-project-invoices-in-psa"></a><span data-ttu-id="fb339-111">Създаване на фактури за проект в PSA</span><span class="sxs-lookup"><span data-stu-id="fb339-111">Creating project invoices in PSA</span></span>

<span data-ttu-id="fb339-112">Фактурите по проект могат да бъдат създавани индивидуално или групово.</span><span class="sxs-lookup"><span data-stu-id="fb339-112">Project invoices can be created one at a time or in bulk.</span></span> <span data-ttu-id="fb339-113">Можете да ги създавате ръчно или да ги конфигурирате да се генерират в автоматизирани цикли.</span><span class="sxs-lookup"><span data-stu-id="fb339-113">You can create them manually, or they can be configured so that they are generated in automated runs.</span></span>

### <a name="manually-create-project-invoices-in-psa"></a><span data-ttu-id="fb339-114">Ръчно създаване на фактури по проект в PSA</span><span class="sxs-lookup"><span data-stu-id="fb339-114">Manually create project invoices in PSA</span></span>

<span data-ttu-id="fb339-115">От страницата със списъка **Договори по проекти** можете да създавате фактури по проекти поотделно за всеки договор по проект или групово за няколко договора по проекти.</span><span class="sxs-lookup"><span data-stu-id="fb339-115">From the **Project Contracts** list page, you can create project invoices separately for each project contract, or you can create invoices in bulk for multiple project contracts.</span></span>

<span data-ttu-id="fb339-116">Изпълнете тази стъпка, за да създадете фактура за конкретен договор по проект.</span><span class="sxs-lookup"><span data-stu-id="fb339-116">Follow this step to create an invoice for a specific project contract.</span></span>

- <span data-ttu-id="fb339-117">На страницата със списъка **Договори по проект** отворете договор по проект и след това изберете **Създаване на фактура**.</span><span class="sxs-lookup"><span data-stu-id="fb339-117">On the **Project Contracts** list page, open a project contract, and then select **Create Invoice**.</span></span>

    ![Създаване на фактури по проект за конкретен договор по проект](media/CreateProjectInvoicesOneByOne.png)

    <span data-ttu-id="fb339-119">Генерира се фактура за всички транзакции за избрания договор по проект, които имат състояние **Готово за фактуриране**.</span><span class="sxs-lookup"><span data-stu-id="fb339-119">An invoice is generated for all transactions for the selected project contract that have a status of **Ready to Invoice**.</span></span> <span data-ttu-id="fb339-120">Тези транзакции включват време, разходи, контролни точки и редове на договор, базирани на продукти.</span><span class="sxs-lookup"><span data-stu-id="fb339-120">These transactions include time, expenses, milestones, and product-based contract lines.</span></span>

<span data-ttu-id="fb339-121">Изпълнете следните стъпки, за да създадете групово фактури.</span><span class="sxs-lookup"><span data-stu-id="fb339-121">Follow these steps to create invoices in bulk.</span></span>

1. <span data-ttu-id="fb339-122">На страницата със списъка **Договори по проекти** изберете един или повече договори по проекти, за които трябва да създадете фактура, след което изберете **Създаване на фактури за проект**.</span><span class="sxs-lookup"><span data-stu-id="fb339-122">On the **Project Contracts** list page, select one or more project contracts that you must create an invoice for, and then select **Create Project Invoices**.</span></span>

    ![Групово създаване на фактури за проект](media/CreateProjectInvoicesBulk.png)

    <span data-ttu-id="fb339-124">Предупредително съобщение ви информира, че може да има закъснение, преди да бъдат създадени фактурите.</span><span class="sxs-lookup"><span data-stu-id="fb339-124">A warning message informs you that there might be a delay before invoices are created.</span></span> <span data-ttu-id="fb339-125">Процесът също е показан.</span><span class="sxs-lookup"><span data-stu-id="fb339-125">The process is also shown.</span></span>

2. <span data-ttu-id="fb339-126">Изберете **ОК**, за да затворите прозореца на съобщението.</span><span class="sxs-lookup"><span data-stu-id="fb339-126">Select **OK** to close the message box.</span></span>

    <span data-ttu-id="fb339-127">Генерира се фактура за всички транзакции в ред на договор, които имат състояние **Готово за фактуриране**.</span><span class="sxs-lookup"><span data-stu-id="fb339-127">An invoice is generated for all transactions on a contract line that have a status of **Ready to Invoice**.</span></span> <span data-ttu-id="fb339-128">Тези транзакции включват време, разходи, контролни точки и редове на договор, базирани на продукти.</span><span class="sxs-lookup"><span data-stu-id="fb339-128">These transactions include time, expenses, milestones, and product-based contract lines.</span></span>

3. <span data-ttu-id="fb339-129">За да прегледате генерираните фактури, отидете на **Продажби** \> **Фактуриране** \> **Фактури**.</span><span class="sxs-lookup"><span data-stu-id="fb339-129">To view the invoices that are generated, go to **Sales** \> **Billing** \> **Invoices**.</span></span> <span data-ttu-id="fb339-130">Ще видите една фактура за всеки договор по проект.</span><span class="sxs-lookup"><span data-stu-id="fb339-130">You will see one invoice for each project contract.</span></span>

### <a name="set-up-automated-creation-of-project-invoices-in-psa"></a><span data-ttu-id="fb339-131">Настройване на автоматизирано създаване на фактури за проект в PSA</span><span class="sxs-lookup"><span data-stu-id="fb339-131">Set up automated creation of project invoices in PSA</span></span>

<span data-ttu-id="fb339-132">Изпълнете следните стъпки, за да конфигурирате автоматичен цикъл на фактуриране в PSA.</span><span class="sxs-lookup"><span data-stu-id="fb339-132">Follow these steps to configure an automated invoice run in PSA.</span></span>

1. <span data-ttu-id="fb339-133">Отидете на **Project Service** \> **Настройки** \> **Пакетни задания**.</span><span class="sxs-lookup"><span data-stu-id="fb339-133">Go to **Project Service** \> **Settings** \> **Batch jobs**.</span></span>
2. <span data-ttu-id="fb339-134">Създайте пакетно задание и го наименувайте **Създаване на фактури в PSA**.</span><span class="sxs-lookup"><span data-stu-id="fb339-134">Create a batch job, and name it **PSA Create Invoices**.</span></span> <span data-ttu-id="fb339-135">Името на пакетното задание трябва да включва термина „създаване на фактури“.</span><span class="sxs-lookup"><span data-stu-id="fb339-135">The name of the batch job must include the term "Create Invoices."</span></span>
3. <span data-ttu-id="fb339-136">В полето **Тип задание** изберете **Няма**.</span><span class="sxs-lookup"><span data-stu-id="fb339-136">In the **Job type** field, select **None**.</span></span> <span data-ttu-id="fb339-137">По подразбиране опциите **Честота дневно** и **Е активно** са зададени на **Да**.</span><span class="sxs-lookup"><span data-stu-id="fb339-137">By default, the **Frequency Daily** and **Is Active** options are set to **Yes**.</span></span>
4. <span data-ttu-id="fb339-138">Изберете **Стартиране на работен поток**.</span><span class="sxs-lookup"><span data-stu-id="fb339-138">Select **Run Workflow**.</span></span> <span data-ttu-id="fb339-139">В диалоговия прозорец **Търсене на запис** ще видите три работни процеса:</span><span class="sxs-lookup"><span data-stu-id="fb339-139">In the **Look Up Record** dialog box, you will see three workflows:</span></span>

    - <span data-ttu-id="fb339-140">ProcessRunCaller</span><span class="sxs-lookup"><span data-stu-id="fb339-140">ProcessRunCaller</span></span>
    - <span data-ttu-id="fb339-141">ProcessRunner</span><span class="sxs-lookup"><span data-stu-id="fb339-141">ProcessRunner</span></span>
    - <span data-ttu-id="fb339-142">UpdateRoleUtilization</span><span class="sxs-lookup"><span data-stu-id="fb339-142">UpdateRoleUtilization</span></span>

5. <span data-ttu-id="fb339-143">Изберете **ProcessRunCaller** и след това **Добавяне**.</span><span class="sxs-lookup"><span data-stu-id="fb339-143">Select **ProcessRunCaller**, and then select **Add**.</span></span>
6. <span data-ttu-id="fb339-144">В следващия диалогов прозорец изберете **OK**.</span><span class="sxs-lookup"><span data-stu-id="fb339-144">In the next dialog box, select **OK**.</span></span> <span data-ttu-id="fb339-145">Работен поток **Заспиване** е последван от работен поток **Обработване**.</span><span class="sxs-lookup"><span data-stu-id="fb339-145">A **Sleep** workflow is followed by a **Process** workflow.</span></span>

    <span data-ttu-id="fb339-146">Можете също да изберете **ProcessRunner** в стъпка 5.</span><span class="sxs-lookup"><span data-stu-id="fb339-146">You can also select **ProcessRunner** in step 5.</span></span> <span data-ttu-id="fb339-147">След това, когато изберете **OK**, работният поток **Обработка** е последван от работен поток **Заспиване**.</span><span class="sxs-lookup"><span data-stu-id="fb339-147">Then, when you select **OK**, a **Process** workflow is followed by a **Sleep** workflow.</span></span>

<span data-ttu-id="fb339-148">Работните потоци **ProcessRunCaller** и **ProcessRunner** създават фактури.</span><span class="sxs-lookup"><span data-stu-id="fb339-148">The **ProcessRunCaller** and **ProcessRunner** workflows create invoices.</span></span> <span data-ttu-id="fb339-149">**ProcessRunCaller** извиква **ProcessRunner**.</span><span class="sxs-lookup"><span data-stu-id="fb339-149">**ProcessRunCaller** calls **ProcessRunner**.</span></span> <span data-ttu-id="fb339-150">**ProcessRunner** е работният поток, който всъщност създава фактурите.</span><span class="sxs-lookup"><span data-stu-id="fb339-150">**ProcessRunner** is the workflow that actually creates the invoices.</span></span> <span data-ttu-id="fb339-151">Той преминава през всички редове на договора, за които трябва да бъдат създадени фактури, и създава фактури за тези редове.</span><span class="sxs-lookup"><span data-stu-id="fb339-151">It goes through all the contract lines that invoices must be created for, and it creates invoices for those lines.</span></span> <span data-ttu-id="fb339-152">За да определи редовете на договора, за които трябва да бъдат създадени фактури, заданието търси в датите на изпълнение на фактурите за редовете на договора.</span><span class="sxs-lookup"><span data-stu-id="fb339-152">To determine the contract lines that invoices must be created for, the job looks at invoice run dates for the contract lines.</span></span> <span data-ttu-id="fb339-153">Ако редове на договор, които принадлежат към един договор, имат една и съща дата на изпълнение на фактура, транзакциите се комбинират в една фактура, която има два реда.</span><span class="sxs-lookup"><span data-stu-id="fb339-153">If contract lines that belong to one contract have the same invoice run date, the transactions are combined into one invoice that has two invoice lines.</span></span> <span data-ttu-id="fb339-154">Ако няма транзакции, за които да бъдат създадени фактури, заданието пропуска създаването на фактури.</span><span class="sxs-lookup"><span data-stu-id="fb339-154">If there are no transactions to create invoices for, the job skips invoice creation.</span></span>

<span data-ttu-id="fb339-155">След като **ProcessRunner** завърши изпълнението на цикъла, той извиква **ProcessRunCaller**, дава крайния час, и се затваря.</span><span class="sxs-lookup"><span data-stu-id="fb339-155">After **ProcessRunner** has finished running, it calls **ProcessRunCaller**, provides the end time, and is closed.</span></span> <span data-ttu-id="fb339-156">**ProcessRunCaller** след това стартира таймер, който работи в продължение на 24 часа от посочения краен час.</span><span class="sxs-lookup"><span data-stu-id="fb339-156">**ProcessRunCaller** then starts a timer that runs for 24 hours from the specified end time.</span></span> <span data-ttu-id="fb339-157">В края на таймера **ProcessRunCaller** се затваря.</span><span class="sxs-lookup"><span data-stu-id="fb339-157">At the end of the timer, **ProcessRunCaller** is closed.</span></span>

<span data-ttu-id="fb339-158">Заданието за пакетно обработване за създаване на фактури е повтарящо се задание.</span><span class="sxs-lookup"><span data-stu-id="fb339-158">The batch process job for creating invoices is a recurrent job.</span></span> <span data-ttu-id="fb339-159">Ако това пакетно обработване се изпълнява много пъти, се създават няколко екземпляра на заданието и причиняват грешки.</span><span class="sxs-lookup"><span data-stu-id="fb339-159">If this batch process is run many times, multiple instances of the job are created and cause errors.</span></span> <span data-ttu-id="fb339-160">Затова трябва да стартирате пакетното обработване само един път и трябва да го рестартирате само ако спре да работи.</span><span class="sxs-lookup"><span data-stu-id="fb339-160">Therefore, you should start the batch process only one time, and you should restart it only if it stops running.</span></span>
 
### <a name="edit-a-draft-psa-invoice"></a><span data-ttu-id="fb339-161">Редактиране на чернова на фактура в PSA</span><span class="sxs-lookup"><span data-stu-id="fb339-161">Edit a draft PSA invoice</span></span>

<span data-ttu-id="fb339-162">Когато създавате чернова на фактура по проект, всички нефактурирани продажбени транзакции, които са създадени, когато са одобрени записите за време и разходи, се изтеглят във фактурата.</span><span class="sxs-lookup"><span data-stu-id="fb339-162">When you create a draft project invoice, all unbilled sales transactions that were created when the time and expense entries were approved are pulled onto the invoice.</span></span> <span data-ttu-id="fb339-163">Можете да направите следните корекции, докато фактурата все още е в етап на чернова:</span><span class="sxs-lookup"><span data-stu-id="fb339-163">You can make the following adjustments while the invoice is still in a draft stage:</span></span>

- <span data-ttu-id="fb339-164">Изтриване или редактиране на подробностите за ред на фактурата.</span><span class="sxs-lookup"><span data-stu-id="fb339-164">Delete or edit invoice line details.</span></span>
- <span data-ttu-id="fb339-165">Редактиране и коригиране на количеството и типа фактуриране.</span><span class="sxs-lookup"><span data-stu-id="fb339-165">Edit and adjust the quantity and billing type.</span></span>
- <span data-ttu-id="fb339-166">Директно добавяне на време, разходи и такси като транзакции във фактурата.</span><span class="sxs-lookup"><span data-stu-id="fb339-166">Directly add time, expense, and fees as transactions on the invoice.</span></span> <span data-ttu-id="fb339-167">Можете да използвате тази функция, ако редът от фактурата се съпоставя към ред на договор, който позволява тези класове транзакции.</span><span class="sxs-lookup"><span data-stu-id="fb339-167">You can use this feature if the invoice line is mapped to a contract line that allows for these transaction classes.</span></span>

<span data-ttu-id="fb339-168">Изберете **Потвърждаване**, за да потвърдите фактура.</span><span class="sxs-lookup"><span data-stu-id="fb339-168">Select **Confirm** to confirm an invoice.</span></span> <span data-ttu-id="fb339-169">Действието за потвърждаване е еднопосочно.</span><span class="sxs-lookup"><span data-stu-id="fb339-169">The Confirm action is a one-way action.</span></span> <span data-ttu-id="fb339-170">Когато изберете **Потвърждаване**, системата прави фактурата само за четене и създава фактурирани действителни продажби от всяка подробност за ред на фактурата за всеки ред на фактурата.</span><span class="sxs-lookup"><span data-stu-id="fb339-170">When you select **Confirm**, the system makes the invoice read-only and creates billed sales actuals from each invoice line detail for each invoice line.</span></span> <span data-ttu-id="fb339-171">Ако подробностите за реда на фактурата се позовават на нефактурирана действителна продажба, системата също така сторнира нефактурираната действителна продажба.</span><span class="sxs-lookup"><span data-stu-id="fb339-171">If the invoice line detail references an unbilled sales actual, the system also reverses the unbilled sales actual.</span></span> <span data-ttu-id="fb339-172">(Всички подробности за ред на фактура, създадени от запис за време или разходи, ще се позовават на нефактурирана действителна продажба.) Интеграционни системи за счетоводство могат да използват това сторниране, за да сторнират незавършено производство (НП) за счетоводни цели.</span><span class="sxs-lookup"><span data-stu-id="fb339-172">(Any invoice line detail that was created from a time or expense entry will reference an unbilled sales actual.) General ledger integration systems can use this reversal to reverse project work in progress (WIP) for accounting purposes.</span></span>

### <a name="correct-a-confirmed-psa-invoice"></a><span data-ttu-id="fb339-173">Коригиране на потвърдена фактура в PSA</span><span class="sxs-lookup"><span data-stu-id="fb339-173">Correct a confirmed PSA invoice</span></span>

<span data-ttu-id="fb339-174">Потвърдени фактури в PSA могат да бъдат редактирани (коригирани).</span><span class="sxs-lookup"><span data-stu-id="fb339-174">Confirmed PSA invoices can be edited (corrected).</span></span> <span data-ttu-id="fb339-175">Когато коригирате потвърдена фактура, се създава нова чернова на коригираща фактура.</span><span class="sxs-lookup"><span data-stu-id="fb339-175">When you correct a confirmed invoice, a new draft corrective invoice is created.</span></span> <span data-ttu-id="fb339-176">Тъй като се предполага, че искате да сторнирате всички транзакции и количества от първоначалната фактура, тази коригираща фактура включва всички транзакции от оригиналната фактура и всички количества в нея са 0 (нула).</span><span class="sxs-lookup"><span data-stu-id="fb339-176">Because the assumption is that you want to reverse all the transactions and quantities from the original invoice, this corrective invoice includes all the transactions from the original invoice, and all the quantities on it are 0 (zero).</span></span>

<span data-ttu-id="fb339-177">Ако транзакциите не изискват корекция, можете да ги премахнете от черновата на коригираща фактура.</span><span class="sxs-lookup"><span data-stu-id="fb339-177">If any transactions don't require correction, you can remove them from the draft corrective invoice.</span></span> <span data-ttu-id="fb339-178">Ако искате да сторнирате или да върнете само частично количество, можете да редактирате полето **Количество** в подробностите за реда.</span><span class="sxs-lookup"><span data-stu-id="fb339-178">If you want to reverse or return only a partial quantity, you can edit the **Quantity** field on the line detail.</span></span> <span data-ttu-id="fb339-179">Ако отворите подробностите за реда на фактурата, можете да видите количеството в първоначалната фактура.</span><span class="sxs-lookup"><span data-stu-id="fb339-179">If you open the invoice line detail, you can see the original invoice quantity.</span></span> <span data-ttu-id="fb339-180">След това можете да редактирате количеството в текущата фактура, така че да е по-малко или повече от количеството в първоначалната фактура.</span><span class="sxs-lookup"><span data-stu-id="fb339-180">You can then edit the current invoice quantity so that it's less than or more than the original invoice quantity.</span></span>

<span data-ttu-id="fb339-181">Когато потвърдите коригираща фактура, първоначално фактурираните действителни продажби се сторнират и се създават нови фактурирани действителни продажби.</span><span class="sxs-lookup"><span data-stu-id="fb339-181">When you confirm a corrective invoice, the original billed sales actual is reversed, and a new billed sales actual is created.</span></span> <span data-ttu-id="fb339-182">Ако количеството е било намалено, разликата ще доведе до създаването също и на нова нефактурирана действителна продажба.</span><span class="sxs-lookup"><span data-stu-id="fb339-182">If the quantity was reduced, the difference will cause a new unbilled sales actual to be created too.</span></span> <span data-ttu-id="fb339-183">Например, ако първоначалните фактурирани продажби са били за осем часа, а подробностите на реда на коригиращата фактура имат намалено количество от шест часа, PSA сторнира реда на първоначално фактурираната продажба и създава две нови действителни данни:</span><span class="sxs-lookup"><span data-stu-id="fb339-183">For example, if the original billed sales was for eight hours, and the corrective invoice line detail has a reduced quantity of six hours, PSA reverses the original billed sales line and creates two new actuals:</span></span>

- <span data-ttu-id="fb339-184">фактурирана действителна продажба за шест часа.</span><span class="sxs-lookup"><span data-stu-id="fb339-184">A billed sales actual for six hours.</span></span>
- <span data-ttu-id="fb339-185">нефактурирана действителна продажба за оставащите два часа.</span><span class="sxs-lookup"><span data-stu-id="fb339-185">An unbilled sales actual for the remaining two hours.</span></span> <span data-ttu-id="fb339-186">Тази транзакция може или да бъде фактурирана по-късно, или отбелязана като неплатима, в зависимост от договорките с клиента.</span><span class="sxs-lookup"><span data-stu-id="fb339-186">This transaction can either be billed later or marked as non-chargeable, depending on the negotiations with the customer.</span></span>
