---
title: Настройване на автоматично създаване на фактура
description: Тази тема предоставя информация за настройване и конфигуриране на автоматично създаване на проформа фактури.
author: rumant
manager: Annbe
ms.date: 04/05/2021
ms.topic: article
ms.service: project-operations
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: 359c5902e0b6a08ab7fc982095062e4d1816db6c
ms.sourcegitcommit: ca0fc078d1a12484eca193fe051b8442c0559db8
ms.translationtype: HT
ms.contentlocale: bg-BG
ms.lasthandoff: 04/07/2021
ms.locfileid: "5866768"
---
# <a name="set-up-automatic-invoice-creation"></a><span data-ttu-id="01b29-103">Настройване на автоматично създаване на фактура</span><span class="sxs-lookup"><span data-stu-id="01b29-103">Set up automatic invoice creation</span></span> 
 
<span data-ttu-id="01b29-104">_**Отнася се за:** Олекотено внедряване – сделка към проформа фактуриране, Project Operations за сценарии, базирани на ресурси / без складови наличности_</span><span class="sxs-lookup"><span data-stu-id="01b29-104">_**Applies To:** Lite deployment - deal to proforma invoicing, Project Operations for resource/non-stocked based scenarios_</span></span>

<span data-ttu-id="01b29-105">Можете да конфигурирате автоматично създаване на фактура в Dynamics 365 Project Operations.</span><span class="sxs-lookup"><span data-stu-id="01b29-105">You can configure automatic invoice creation in Dynamics 365 Project Operations.</span></span> <span data-ttu-id="01b29-106">Системата създава проект на проформа фактура въз основа на графика на фактурите за всеки договор за проект и ред на договора.</span><span class="sxs-lookup"><span data-stu-id="01b29-106">The system creates a draft proforma invoice based on the invoice schedule for each project contract and contract line.</span></span> <span data-ttu-id="01b29-107">Графиците за фактури се конфигурират на ниво линия на договора.</span><span class="sxs-lookup"><span data-stu-id="01b29-107">Invoice schedules are configured at the contract line level.</span></span> <span data-ttu-id="01b29-108">Всеки ред в договора може да има отделен график за фактури или един и същ график за фактури може да бъде включен във всеки ред от договора.</span><span class="sxs-lookup"><span data-stu-id="01b29-108">Each line on a contract can have a distinct invoice schedule, or the same invoice schedule can be included on every line of the contract.</span></span>

<span data-ttu-id="01b29-109">Когато създавате фактура, системата винаги създава поне една фактура за договор за проект.</span><span class="sxs-lookup"><span data-stu-id="01b29-109">When you create an invoice, the system always creates at least one invoice per project contract.</span></span> <span data-ttu-id="01b29-110">В някои случаи може да са създадени множество фактури.</span><span class="sxs-lookup"><span data-stu-id="01b29-110">In some cases, there may be multiple invoices created.</span></span> <span data-ttu-id="01b29-111">Например, ако договорът има множество клиенти, ще бъде създаден същият брой фактури като броя клиенти, които имат фактурирани транзакции, за да фактурират по този договор за проект.</span><span class="sxs-lookup"><span data-stu-id="01b29-111">For example, if the contract has multiple customers, the same number of invoices will be created as the number of customers that have billable transactions to invoice on that project contract.</span></span>

## <a name="understand-how-transactions-are-included-on-an-invoice"></a><span data-ttu-id="01b29-112">Разберете как транзакциите се включват във фактура</span><span class="sxs-lookup"><span data-stu-id="01b29-112">Understand how transactions are included on an invoice</span></span> 

<span data-ttu-id="01b29-113">Понякога всеки ред на договора, базиран на проект, определя отделен график на фактурите.</span><span class="sxs-lookup"><span data-stu-id="01b29-113">Sometimes, each project-based contract line specifies a separate invoice schedule.</span></span> <span data-ttu-id="01b29-114">Например услугите за изпълнение на договора Adatum имат следните договорни линии:</span><span class="sxs-lookup"><span data-stu-id="01b29-114">For example, implementation services for the Adatum contract have the following contract lines:</span></span>

- <span data-ttu-id="01b29-115">Прототип, който е фиксирана цена с два ръчно създадени етапа.</span><span class="sxs-lookup"><span data-stu-id="01b29-115">Prototype work that is a fixed price with two manually created milestones.</span></span>
- <span data-ttu-id="01b29-116">Работа по внедряването, която включва време и ще бъде таксувана двуседмично в понеделник.</span><span class="sxs-lookup"><span data-stu-id="01b29-116">Implementation work that includes Time and will be billed bi-weekly on Mondays.</span></span>
- <span data-ttu-id="01b29-117">Понесени разходи, които трябва да бъдат таксувани ежемесечно в първия понеделник на всеки месец.</span><span class="sxs-lookup"><span data-stu-id="01b29-117">Expenses incurred that need to be billed monthly on the first Monday of each month.</span></span>

<span data-ttu-id="01b29-118">Графиците за фактури, дефинирани за всяка от тези две договорени покупки, изглеждат като следната таблица:</span><span class="sxs-lookup"><span data-stu-id="01b29-118">Invoice schedules defined on each of these two line items look like the following table:</span></span>

| <span data-ttu-id="01b29-119">Aспекти на договор</span><span class="sxs-lookup"><span data-stu-id="01b29-119">Contract line</span></span> | <span data-ttu-id="01b29-120">Дата на създаване на фактура</span><span class="sxs-lookup"><span data-stu-id="01b29-120">Invoice run date</span></span> | <span data-ttu-id="01b29-121">Дата на прекратяване на транзакцията</span><span class="sxs-lookup"><span data-stu-id="01b29-121">Transaction cut-off date</span></span> | <span data-ttu-id="01b29-122">Дата на контролна точка</span><span class="sxs-lookup"><span data-stu-id="01b29-122">Milestone date</span></span> | <span data-ttu-id="01b29-123">Сума на контролна точка</span><span class="sxs-lookup"><span data-stu-id="01b29-123">Milestone amount</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="01b29-124">Работа по прототип</span><span class="sxs-lookup"><span data-stu-id="01b29-124">Prototype work</span></span> | <span data-ttu-id="01b29-125">Понеделник, 5 октомври</span><span class="sxs-lookup"><span data-stu-id="01b29-125">October 5, Monday</span></span> | - | <span data-ttu-id="01b29-126">Понеделник, 5 октомври</span><span class="sxs-lookup"><span data-stu-id="01b29-126">October 5, Monday</span></span> | <span data-ttu-id="01b29-127">5000 USD</span><span class="sxs-lookup"><span data-stu-id="01b29-127">5000 USD</span></span> |
| - | <span data-ttu-id="01b29-128">Вторник, 3 ноември</span><span class="sxs-lookup"><span data-stu-id="01b29-128">November 3, Tuesday</span></span> | - | <span data-ttu-id="01b29-129">Вторник, 3 ноември</span><span class="sxs-lookup"><span data-stu-id="01b29-129">November 3, Tuesday</span></span> | <span data-ttu-id="01b29-130">12,000 USD</span><span class="sxs-lookup"><span data-stu-id="01b29-130">12,000 USD</span></span> |
| <span data-ttu-id="01b29-131">Работа по прилагане</span><span class="sxs-lookup"><span data-stu-id="01b29-131">Implementation work</span></span> | <span data-ttu-id="01b29-132">Понеделник, 5 октомври</span><span class="sxs-lookup"><span data-stu-id="01b29-132">October 5, Monday</span></span> | <span data-ttu-id="01b29-133">Неделя, 4 октомври</span><span class="sxs-lookup"><span data-stu-id="01b29-133">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="01b29-134">Понеделник, 19 октомври</span><span class="sxs-lookup"><span data-stu-id="01b29-134">October 19, Monday</span></span> | <span data-ttu-id="01b29-135">Неделя, 18 октомври</span><span class="sxs-lookup"><span data-stu-id="01b29-135">October 18, Sunday</span></span> | - | - |
| - | <span data-ttu-id="01b29-136">Понеделник, 2 ноември</span><span class="sxs-lookup"><span data-stu-id="01b29-136">November 2, Monday</span></span> | <span data-ttu-id="01b29-137">Неделя, 1 ноември</span><span class="sxs-lookup"><span data-stu-id="01b29-137">November 1, Sunday</span></span> | - | - |
| - | <span data-ttu-id="01b29-138">Понеделник, 16 ноември</span><span class="sxs-lookup"><span data-stu-id="01b29-138">November 16, Monday</span></span> | <span data-ttu-id="01b29-139">Неделя, 15 ноември</span><span class="sxs-lookup"><span data-stu-id="01b29-139">November 15, Sunday</span></span> | - | - |
| <span data-ttu-id="01b29-140">Направени разходи</span><span class="sxs-lookup"><span data-stu-id="01b29-140">Expenses incurred</span></span> | <span data-ttu-id="01b29-141">Понеделник, 5 октомври</span><span class="sxs-lookup"><span data-stu-id="01b29-141">October 5, Monday</span></span> | <span data-ttu-id="01b29-142">Неделя, 4 октомври</span><span class="sxs-lookup"><span data-stu-id="01b29-142">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="01b29-143">Понеделник, 2 ноември</span><span class="sxs-lookup"><span data-stu-id="01b29-143">November 2, Monday</span></span> | <span data-ttu-id="01b29-144">Неделя, 1 ноември</span><span class="sxs-lookup"><span data-stu-id="01b29-144">November 1, Sunday</span></span> | - | - |

<span data-ttu-id="01b29-145">В този пример, когато автоматичното фактуриране работи:</span><span class="sxs-lookup"><span data-stu-id="01b29-145">In this example when the automatic invoicing runs on:</span></span>

- <span data-ttu-id="01b29-146">**4 октомври или която и да е дата преди**: Не се генерира фактура за този договор, тъй като таблицата **График на фактурите** за всеки от тези редове на договора не извиква 4 октомври, неделя като дата на изпълнение на фактура.</span><span class="sxs-lookup"><span data-stu-id="01b29-146">**October 4 or any date before**: No invoice is generated for this contract because the **Invoice Schedule** table for each of these contract lines doesn't call out October 4, Sunday as an invoice run date.</span></span>
- <span data-ttu-id="01b29-147">**Понеделник, 5 октомври**: Генерира се една фактура за:</span><span class="sxs-lookup"><span data-stu-id="01b29-147">**October 5 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="01b29-148">Прототипна работа, която включва крайъгълен камък, ако е означен като **Готови за фактуриране**.</span><span class="sxs-lookup"><span data-stu-id="01b29-148">Prototype work that includes the milestone, if it is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="01b29-149">Работа по внедряване, която включва всички транзакции във времето, създадени преди крайната дата на транзакцията на 4 октомври, неделя, която е маркирана като **Готови за фактуриране**.</span><span class="sxs-lookup"><span data-stu-id="01b29-149">Implementation work that includes all Time transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="01b29-150">Направен е разход, който включва всички транзакции на разходи, създадени преди крайната дата на транзакцията на 4 октомври, неделя, която е маркирана като **Готови за фактуриране**.</span><span class="sxs-lookup"><span data-stu-id="01b29-150">Expense incurred that includes all Expense transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
  
- <span data-ttu-id="01b29-151">**На 6 октомври или която и да е дата преди 19 октомври**: Не се генерира фактура за този договор, тъй като таблицата **График на фактурите** за всеки от тези редове на договора не извиква 6 октомври или която и да е дата преди 19 октомври като дата на изпълнение на фактура.</span><span class="sxs-lookup"><span data-stu-id="01b29-151">**On October 6 or any date before October 19**: No invoice is generated for this contract since the **Invoice Schedule** table for each of these contract lines does not call out October 6 or any date before October 19 as an invoice run date.</span></span>
- <span data-ttu-id="01b29-152">**Понеделник, 19 октомври**: Една фактура се генерира за работа по внедряване, която включва всички транзакции във времето, създадени преди крайната дата на транзакцията на 18 октомври, неделя, която е маркирана като **Готови за фактуриране**.</span><span class="sxs-lookup"><span data-stu-id="01b29-152">**October 19, Monday**: One invoice is generated for implementation work that includes all Time transactions created before the transaction cut-off date of October 18, Sunday, that is marked as **Ready to Invoice**.</span></span>
- <span data-ttu-id="01b29-153">**Понеделник, 2 ноември**: Генерира се една фактура за:</span><span class="sxs-lookup"><span data-stu-id="01b29-153">**November 2 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="01b29-154">Работа по внедряване, която включва всички транзакции във времето, създадени преди крайната дата на транзакцията на 1 ноември, неделя, която е маркирана като **Готови за фактуриране**.</span><span class="sxs-lookup"><span data-stu-id="01b29-154">Implementation work that includes all Time transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="01b29-155">Направен е разход, който включва всички транзакции на разходи, създадени преди крайната дата на транзакцията на 1 ноември, неделя, която е маркирана като **Готови за фактуриране**.</span><span class="sxs-lookup"><span data-stu-id="01b29-155">Expense incurred that includes all Expense transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>

- <span data-ttu-id="01b29-156">**3 ноември, вторник**: Една фактура се генерира за работа с прототип, която включва етапа за 12000 USD, ако е маркиран като **Готови за фактуриране**.</span><span class="sxs-lookup"><span data-stu-id="01b29-156">**November 3, Tuesday**: One invoice is generated for prototype work that includes the milestone for 12000 USD, if it is marked as **Ready to Invoice**.</span></span>

## <a name="configure-automatic-invoicing"></a><span data-ttu-id="01b29-157">Конфигуриране на автоматично фактуриране</span><span class="sxs-lookup"><span data-stu-id="01b29-157">Configure automatic invoicing</span></span>

<span data-ttu-id="01b29-158">Изпълнете следните стъпки, за да конфигурирате автоматичен цикъл на фактуриране.</span><span class="sxs-lookup"><span data-stu-id="01b29-158">Complete the following steps to configure an automated invoice run.</span></span>

1. <span data-ttu-id="01b29-159">В **Project Operations**, отидете на **Настройки** > **Повтаряща се настройка на фактура**.</span><span class="sxs-lookup"><span data-stu-id="01b29-159">In **Project Operations**, go to **Settings** > **Recurring Invoice Setup**.</span></span>
2. <span data-ttu-id="01b29-160">Създайте пакетно задание и го наименувайте **Създаване на фактури в Project Operations**.</span><span class="sxs-lookup"><span data-stu-id="01b29-160">Create a batch job, and name it **rPoject Operations Create Invoices**.</span></span> <span data-ttu-id="01b29-161">Името на пакетното задание трябва да включва думите „създаване на фактури“.</span><span class="sxs-lookup"><span data-stu-id="01b29-161">The name of the batch job must include the words, "create invoices".</span></span>
3. <span data-ttu-id="01b29-162">В полето **Тип задание** изберете **Няма**.</span><span class="sxs-lookup"><span data-stu-id="01b29-162">In the **Job Type** field, select **None**.</span></span> <span data-ttu-id="01b29-163">По подразбиране полетата **Честота дневно** и **Е активно** са зададени на **Да**.</span><span class="sxs-lookup"><span data-stu-id="01b29-163">By default, the **Frequency Daily** and **Is Active** fields are set to **Yes**.</span></span>
4. <span data-ttu-id="01b29-164">Изберете **Стартиране на работен поток**.</span><span class="sxs-lookup"><span data-stu-id="01b29-164">Select **Run Workflow**.</span></span> <span data-ttu-id="01b29-165">В диалоговия прозорец **Търсене на запис** ще видите три работни процеса:</span><span class="sxs-lookup"><span data-stu-id="01b29-165">In the **Look Up Record** dialog box, you will see three workflows:</span></span>

- <span data-ttu-id="01b29-166">ProcessRunCaller</span><span class="sxs-lookup"><span data-stu-id="01b29-166">ProcessRunCaller</span></span>
- <span data-ttu-id="01b29-167">ProcessRunner</span><span class="sxs-lookup"><span data-stu-id="01b29-167">ProcessRunner</span></span>
- <span data-ttu-id="01b29-168">UpdateRoleUtilization</span><span class="sxs-lookup"><span data-stu-id="01b29-168">UpdateRoleUtilization</span></span>

5. <span data-ttu-id="01b29-169">Изберете **ProcessRunCaller** и след това **Добавяне**.</span><span class="sxs-lookup"><span data-stu-id="01b29-169">Select **ProcessRunCaller**, and then select **Add**.</span></span>
6. <span data-ttu-id="01b29-170">В следващия диалогов прозорец изберете **OK**.</span><span class="sxs-lookup"><span data-stu-id="01b29-170">In the next dialog box, select **OK**.</span></span> <span data-ttu-id="01b29-171">Работен поток **Заспиване** е последван от работен поток **Обработване**.</span><span class="sxs-lookup"><span data-stu-id="01b29-171">A **Sleep** workflow is followed by a **Process** workflow.</span></span> 

> [!NOTE]
> <span data-ttu-id="01b29-172">Можете също да изберете **ProcessRunner** в стъпка 5.</span><span class="sxs-lookup"><span data-stu-id="01b29-172">You can also select **ProcessRunner** in step 5.</span></span> <span data-ttu-id="01b29-173">След това, когато изберете **OK**, работният поток **Обработка** е последван от работен поток **Заспиване**.</span><span class="sxs-lookup"><span data-stu-id="01b29-173">Then, when you select **OK**, a **Process** workflow is followed by a **Sleep** workflow.</span></span>

<span data-ttu-id="01b29-174">Работните потоци **ProcessRunCaller** и **ProcessRunner** създават фактури.</span><span class="sxs-lookup"><span data-stu-id="01b29-174">The **ProcessRunCaller** and **ProcessRunner** workflows create invoices.</span></span> <span data-ttu-id="01b29-175">**ProcessRunCaller** извиква **ProcessRunner**.</span><span class="sxs-lookup"><span data-stu-id="01b29-175">**ProcessRunCaller** calls **ProcessRunner**.</span></span> <span data-ttu-id="01b29-176">**ProcessRunner** е работният поток, който всъщност създава фактурите.</span><span class="sxs-lookup"><span data-stu-id="01b29-176">**ProcessRunner** is the workflow that actually creates the invoices.</span></span> <span data-ttu-id="01b29-177">Работният поток преминава през всички редове на договора, за които трябва да бъдат създадени фактури, и създава фактури за тези редове.</span><span class="sxs-lookup"><span data-stu-id="01b29-177">The workflow goes through all the contract lines that invoices must be created for, and creates invoices for those lines.</span></span> <span data-ttu-id="01b29-178">За да определи редовете на договора, за които трябва да бъдат създадени фактури, заданието търси в датите на изпълнение на фактурите за редовете на договора.</span><span class="sxs-lookup"><span data-stu-id="01b29-178">To determine the contract lines that invoices must be created for, the job looks at invoice run dates for the contract lines.</span></span> <span data-ttu-id="01b29-179">Ако редове на договор, които принадлежат към един договор, имат една и съща дата на изпълнение на фактура, транзакциите се комбинират в една фактура, която има два реда.</span><span class="sxs-lookup"><span data-stu-id="01b29-179">If contract lines that belong to one contract have the same invoice run date, the transactions are combined into one invoice that has two invoice lines.</span></span> <span data-ttu-id="01b29-180">Ако няма транзакции, за които да бъдат създадени фактури, заданието пропуска създаването на фактура.</span><span class="sxs-lookup"><span data-stu-id="01b29-180">If there are no transactions to create invoices for, the job skips creating an invoice.</span></span>

<span data-ttu-id="01b29-181">След като **ProcessRunner** завърши изпълнението на цикъла, той извиква **ProcessRunCaller**, дава крайния час, и се затваря.</span><span class="sxs-lookup"><span data-stu-id="01b29-181">After **ProcessRunner** has finished running, it calls **ProcessRunCaller**, provides the end time, and is closed.</span></span> <span data-ttu-id="01b29-182">**ProcessRunCaller** след това стартира таймер, който работи в продължение на 24 часа от посочения краен час.</span><span class="sxs-lookup"><span data-stu-id="01b29-182">**ProcessRunCaller** then starts a timer that runs for 24-hours from the specified end time.</span></span> <span data-ttu-id="01b29-183">В края на таймера **ProcessRunCaller** се затваря.</span><span class="sxs-lookup"><span data-stu-id="01b29-183">At the end of the timer, **ProcessRunCaller** is closed.</span></span>

<span data-ttu-id="01b29-184">Заданието за пакетно обработване за създаване на фактури е повтарящо се задание.</span><span class="sxs-lookup"><span data-stu-id="01b29-184">The batch process job for creating invoices is a recurrent job.</span></span> <span data-ttu-id="01b29-185">Ако това пакетно обработване се изпълнява много пъти, се създават няколко екземпляра на заданието и причинява грешки.</span><span class="sxs-lookup"><span data-stu-id="01b29-185">If this batch process is run many times, multiple instances of the job are created and causes errors.</span></span> <span data-ttu-id="01b29-186">Затова трябва да стартирате пакетното обработване само един път и след това рестартирайте само ако спре да работи.</span><span class="sxs-lookup"><span data-stu-id="01b29-186">Therefore, you should start the batch process only one time, and then restart only if it stops running.</span></span>

> [!NOTE]
> <span data-ttu-id="01b29-187">Партидното фактуриране в Project Operations се изпълнява само за линиите на договор за проект, които са конфигурирани от графици за фактури.</span><span class="sxs-lookup"><span data-stu-id="01b29-187">Batch invoicing in Project Operations only runs for project contract lines that are configured by invoice schedules.</span></span> <span data-ttu-id="01b29-188">Аспекти на договор с метод на фактуриране по фиксирана цена трябва да имат конфигурирани контролни точки.</span><span class="sxs-lookup"><span data-stu-id="01b29-188">A contract line with a fixed price billing method must have milestones configured.</span></span> <span data-ttu-id="01b29-189">Аспекти на договор по проект с метод на фактуриране по време и материали ще се нуждаят от зададен график за фактуриране, базиран на дата.</span><span class="sxs-lookup"><span data-stu-id="01b29-189">A project contract line with a time and material billing method will need a date-based invoice schedule set up.</span></span>


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
