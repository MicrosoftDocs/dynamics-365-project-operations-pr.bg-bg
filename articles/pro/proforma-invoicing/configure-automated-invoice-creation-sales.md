---
title: Конфигуриране на автоматично създаване на фактура – олекотено
description: Тази тема предоставя информация за конфигуриране на автоматично създаване на проформа фактури.
author: rumant
manager: Annbe
ms.date: 10/13/2020
ms.topic: article
ms.service: project-operations
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: 0ce9cb9090c44762f370bf8d574d179077b6a821
ms.sourcegitcommit: 625878bf48ea530f3381843be0e778cebbbf1922
ms.translationtype: HT
ms.contentlocale: bg-BG
ms.lasthandoff: 10/30/2020
ms.locfileid: "4176553"
---
# <a name="configure-automatic-invoice-creation---lite"></a>Конфигуриране на автоматично създаване на фактура – олекотено
 
_**Прилага се за:** Леко внедряване – фактуриране на сделката към проформа_

Можете да конфигурирате автоматично създаване на фактури в Dynamics 365 Project Operations. Системата създава проект на проформа фактура въз основа на графика на фактурите за всеки договор за проект и ред на договора. Графиците за фактури се конфигурират на ниво линия на договора. Всеки ред в договора може да има отделен график за фактури или един и същ график за фактури може да бъде включен във всеки ред от договора.

Когато създавате фактура, системата винаги създава поне една фактура за договор за проект. В някои случаи може да са създадени множество фактури.

Например, ако договорът има множество клиенти, ще бъде създаден същият брой фактури като броя клиенти, които имат фактурирани транзакции, за да фактурират по този договор за проект.

## <a name="understand-how-transactions-are-included-on-an-invoice"></a>Разберете как транзакциите се включват във фактура 

Понякога всеки ред на договора, базиран на проект, определя отделен график на фактурите. Например услугите за изпълнение на договора Adatum имат следните договорни линии:

- Прототип, който е фиксирана цена с два ръчно създадени етапа.
- Работа по внедряването, която включва време и ще бъде таксувана двуседмично в понеделник.
- Понесени разходи, които трябва да бъдат таксувани ежемесечно в първия понеделник на всеки месец.

Графиците за фактури, дефинирани за всяка от тези две договорени покупки, изглеждат като следната таблица:

| Aспекти на договор | Дата на създаване на фактура | Дата на прекратяване на транзакцията | Дата на контролна точка | Сума на контролна точка |
| --- | --- | --- | --- | --- |
| Работа по прототип | Понеделник, 5 октомври | - | Понеделник, 5 октомври | 5000 USD |
| - | Вторник, 3 ноември | - | Вторник, 3 ноември | 12,000 USD |
| Работа по прилагане | Понеделник, 5 октомври | Неделя, 4 октомври | - | - |
| - | Понеделник, 19 октомври | Неделя, 18 октомври | - | - |
| - | Понеделник, 2 ноември | Неделя, 1 ноември | - | - |
| - | Понеделник, 16 ноември | Неделя, 15 ноември | - | - |
| Направени разходи | Понеделник, 5 октомври | Неделя, 4 октомври | - | - |
| - | Понеделник, 2 ноември | Неделя, 1 ноември | - | - |

В този пример, когато автоматичното фактуриране работи:

- **4 октомври или която и да е дата преди**: Не се генерира фактура за този договор, тъй като таблицата **График на фактурите** за всеки от тези редове на договора не извиква 4 октомври, неделя като дата на изпълнение на фактура.
- **Понеделник, 5 октомври**: Генерира се една фактура за:

    - Прототипна работа, която включва крайъгълен камък, ако е означен като **Готови за фактуриране**.
    - Работа по внедряване, която включва всички транзакции във времето, създадени преди крайната дата на транзакцията на 4 октомври, неделя, която е маркирана като **Готови за фактуриране**.
    - Направен е разход, който включва всички транзакции на разходи, създадени преди крайната дата на транзакцията на 4 октомври, неделя, която е маркирана като **Готови за фактуриране**.
  
- **На 6 октомври или която и да е дата преди 19 октомври**: Не се генерира фактура за този договор, тъй като таблицата **График на фактурите** за всеки от тези редове на договора не извиква 6 октомври или която и да е дата преди 19 октомври като дата на изпълнение на фактура.
- **Понеделник, 19 октомври**: Една фактура се генерира за работа по внедряване, която включва всички транзакции във времето, създадени преди крайната дата на транзакцията на 18 октомври, неделя, която е маркирана като **Готови за фактуриране**.
- **Понеделник, 2 ноември**: Генерира се една фактура за:

    - Работа по внедряване, която включва всички транзакции във времето, създадени преди крайната дата на транзакцията на 1 ноември, неделя, която е маркирана като **Готови за фактуриране**.
    - Направен е разход, който включва всички транзакции на разходи, създадени преди крайната дата на транзакцията на 1 ноември, неделя, която е маркирана като **Готови за фактуриране**.

- **3 ноември, вторник**: Една фактура се генерира за работа с прототип, която включва етапа за 12000 USD, ако е маркиран като **Готови за фактуриране**.

## <a name="configure-automatic-invoicing"></a>Конфигуриране на автоматично фактуриране

Изпълнете следните стъпки, за да конфигурирате автоматичен цикъл на фактуриране.

1. В **Project Operations**, отидете на **Настройки** > **Повтаряща се настройка на фактура**.
2. Създайте пакетно задание и го наименувайте **Създаване на фактури в Project Operations**. Името на пакетното задание трябва да включва думите „създаване на фактури“.
3. В полето **Тип задание** изберете **Няма**. По подразбиране полетата **Честота дневно** и **Е активно** са зададени на **Да**.
4. Изберете **Стартиране на работен поток**. В диалоговия прозорец **Търсене на запис** ще видите три работни процеса:

- ProcessRunCaller
- ProcessRunner
- UpdateRoleUtilization

5. Изберете **ProcessRunCaller** и след това **Добавяне**.
6. В следващия диалогов прозорец изберете **OK**. Работен поток **Заспиване** е последван от работен поток **Обработване**. 

> [!NOTE]
> Можете също да изберете **ProcessRunner** в стъпка 5. След това, когато изберете **OK**, работният поток **Обработка** е последван от работен поток **Заспиване**.

Работните потоци **ProcessRunCaller** и **ProcessRunner** създават фактури. **ProcessRunCaller** извиква **ProcessRunner**. **ProcessRunner** е работният поток, който всъщност създава фактурите. Работният поток преминава през всички редове на договора, за които трябва да бъдат създадени фактури, и създава фактури за тези редове. За да определи редовете на договора, за които трябва да бъдат създадени фактури, заданието търси в датите на изпълнение на фактурите за редовете на договора. Ако редове на договор, които принадлежат към един договор, имат една и съща дата на изпълнение на фактура, транзакциите се комбинират в една фактура, която има два реда. Ако няма транзакции, за които да бъдат създадени фактури, заданието пропуска създаването на фактура.

След като **ProcessRunner** завърши изпълнението на цикъла, той извиква **ProcessRunCaller**, дава крайния час, и се затваря. **ProcessRunCaller** след това стартира таймер, който работи в продължение на 24 часа от посочения краен час. В края на таймера **ProcessRunCaller** се затваря.

Заданието за пакетно обработване за създаване на фактури е повтарящо се задание. Ако това пакетно обработване се изпълнява много пъти, се създават няколко екземпляра на заданието и причинява грешки. Затова трябва да стартирате пакетното обработване само един път и след това рестартирайте само ако спре да работи.

> [!NOTE]
> Партидното фактуриране в Project Operations се изпълнява само за линиите на договор за проект, които са конфигурирани от графици за фактури. Аспекти на договор с метод на фактуриране по фиксирана цена трябва да имат конфигурирани контролни точки. Аспекти на договор по проект с метод на фактуриране по време и материали ще се нуждаят от зададен график за фактуриране, базиран на дата.


[!INCLUDE[footer-include](../../includes/footer-banner.md)]